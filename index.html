<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

<input type="file" id="fileInput">


<script>
    const names = ["a", "b", "c", "d", "e", "f", "g", "h"];


    function generateTable() {
        const table = document.createElement("table");
        for (let rowCounter = 0; rowCounter < 8; rowCounter++) {
            const row = table.insertRow();
            row.className += "row " + (rowCounter % 2 === 0) ? "fb" : "fw";
            let cell = row.insertCell();
            cell.textContent = 8 - rowCounter;
            for (let cellCounter = 0; cellCounter < 8; cellCounter++) {
                const cell = row.insertCell();
                cell.className += "cell ";
                cell.className += names[cellCounter] + (8 - rowCounter);
                cell.textContent = getChessForRowAndCell(8 - rowCounter, cellCounter + 1);

            }
        }
        const row = table.insertRow();
        row.insertCell();
        for (let i = 0; i < 10; i++) {
            const cell = row.insertCell();
            cell.textContent = names[i];
        }
        return table;
    }

    function getChessForRowAndCell(row, cell) {
        if (row === 2) {
            return "♙";
        } else if (row === 7) {
            return "♟";
        } else if (row === 1 || row === 8) {
            switch (cell) {
                case 1:
                case 8:
                    return (row === 1) ? "♖" : "♜";
                case 2:
                case 7:
                    return (row === 1) ? "♘" : "♞";
                case 3:
                case 6:
                    return (row === 1) ? "♗" : "♝";
                case 4:
                    return (row === 1) ? "♕" : "♛";
                case 5:
                    return (row === 1) ? "♔" : "♚";
            }
        } else {
            return "";
        }
    }

    // document.body.appendChild(generateTable());


    const fileInput = document.getElementById('fileInput');

    fileInput.addEventListener('change', function (e) {
        const file = fileInput.files[0];

        const reader = new FileReader();

        reader.onload = function (e) {
            let table = generateTable();
            generateControls(parseReplay(reader.result), table);
            document.body.appendChild(table);
        };

        reader.readAsText(file);

    });

    function parseReplay(text) {
        const tokens = text.split(" ");
        if (tokens % 2 === 1) {
            alert("Invalid file")
        }
        const out = [];
        for (let i = 0; i < Math.floor(tokens.length / 2); i++) {
            out[i] = {from: tokens[2 * i], to: tokens[2 * i + 1]};
        }
        return out;
    }

    function generateControls(moves, table) {
        const footer = table.createTFoot();
        const cell = footer.insertRow().insertCell();
        cell.colSpan = 8;

        const backwardButton = document.createElement("button");
        backwardButton.innerText = "Backward";
        cell.appendChild(backwardButton);
        backwardButton.moves = moves;

        const forwardButton = document.createElement("button");
        forwardButton.innerText = "Forward";
        cell.appendChild(forwardButton);
        forwardButton.moves = moves;

        let movePointer = 0;

        forwardButton.addEventListener("click", function (e) {
            const moves = e.target.moves;
            if (moves.length <= movePointer) {
                return;
            }
            const from = table.getElementsByClassName(moves[movePointer].from)[0];
            const to = table.getElementsByClassName(moves[movePointer].to)[0];


            to.textContent = from.textContent;
            from.textContent = "";

            movePointer++;
        });
    }


</script>

<link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
<style>
    table * {
        font-family: 'Roboto', sans-serif;
        font-size: 20pt;
    }

    .cell {
        width: 20pt;
        height: 20pt;
    }

    .fb .cell:nth-child(2) {
        background: lightgray;
    }
</style>

</body>
</html>